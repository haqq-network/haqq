(window.webpackJsonp=window.webpackJsonp||[]).push([[150],{704:function(c,g,l){"use strict";l.r(g);var o=l(1),e=Object(o.a)({},(function(){var c=this,g=c.$createElement,l=c._self._c||g;return l("ContentSlotsDistributor",{attrs:{"slot-key":c.$parent.slotKey}},[l("h1",{attrs:{id:"hooks"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#hooks"}},[c._v("#")]),c._v(" Hooks")]),c._v(" "),l("p",[c._v("The "),l("code",[c._v("x/evm")]),c._v(" module implements an "),l("code",[c._v("EvmHooks")]),c._v(" interface that extend and customize the "),l("code",[c._v("Tx")]),c._v(" processing logic externally.")]),c._v(" "),l("p",[c._v("This supports EVM contracts to call native cosmos modules by")]),c._v(" "),l("ol",[l("li",[c._v("defining a log signature and emitting the specific log from the smart contract,")]),c._v(" "),l("li",[c._v("recognizing those logs in the native tx processing code, and")]),c._v(" "),l("li",[c._v("converting them to native module calls.")])]),c._v(" "),l("p",[c._v("To do this, the interface includes a  "),l("code",[c._v("PostTxProcessing")]),c._v(" hook that registers custom "),l("code",[c._v("Tx")]),c._v(" hooks in the "),l("code",[c._v("EvmKeeper")]),c._v(". These  "),l("code",[c._v("Tx")]),c._v(" hooks are processed after the EVM state transition is finalized and doesn't fail. Note that there are no default hooks implemented in the EVM module.")]),c._v(" "),l("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBFdm1Ib29rcyBpbnRlcmZhY2UgewogLy8gTXVzdCBiZSBjYWxsZWQgYWZ0ZXIgdHggaXMgcHJvY2Vzc2VkIHN1Y2Nlc3NmdWxseSwgaWYgcmV0dXJuIGFuIGVycm9yLCB0aGUgd2hvbGUgdHJhbnNhY3Rpb24gaXMgcmV2ZXJ0ZWQuCiBQb3N0VHhQcm9jZXNzaW5nKGN0eCBzZGsuQ29udGV4dCwgbXNnIGNvcmUuTWVzc2FnZSwgcmVjZWlwdCAqZXRodHlwZXMuUmVjZWlwdCkgZXJyb3IKfQo="}}),c._v(" "),l("h2",{attrs:{id:"posttxprocessing"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#posttxprocessing"}},[c._v("#")]),c._v(" "),l("code",[c._v("PostTxProcessing")])]),c._v(" "),l("p",[l("code",[c._v("PostTxProcessing")]),c._v(" is only called after a EVM transaction finished successfully and delegates the call to underlying hooks.  If no hook has been registered, this function returns with a "),l("code",[c._v("nil")]),c._v(" error.")]),c._v(" "),l("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayAqS2VlcGVyKSBQb3N0VHhQcm9jZXNzaW5nKGN0eCBzZGsuQ29udGV4dCwgbXNnIGNvcmUuTWVzc2FnZSwgcmVjZWlwdCAqZXRodHlwZXMuUmVjZWlwdCkgZXJyb3IgewogaWYgay5ob29rcyA9PSBuaWwgewogIHJldHVybiBuaWwKIH0KIHJldHVybiBrLmhvb2tzLlBvc3RUeFByb2Nlc3Npbmcoay5DdHgoKSwgbXNnLCByZWNlaXB0KQp9Cg=="}}),c._v(" "),l("p",[c._v("It's executed in the same cache context as the EVM transaction, if it returns an error, the whole EVM transaction is reverted, if the hook implementor doesn't want to revert the tx, they can always return "),l("code",[c._v("nil")]),c._v(" instead.")]),c._v(" "),l("p",[c._v("The error returned by the hooks is translated to a VM error "),l("code",[c._v("failed to process native logs")]),c._v(", the detailed error message is stored in the return value. The message is sent to native modules asynchronously, there's no way for the caller to catch and recover the error.")]),c._v(" "),l("h2",{attrs:{id:"use-case-call-native-erc20-module-on-evmos"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#use-case-call-native-erc20-module-on-evmos"}},[c._v("#")]),c._v(" Use Case: Call Native ERC20 Module on Evmos")]),c._v(" "),l("p",[c._v("Here is an example taken from the Evmos "),l("a",{attrs:{href:"https://docs.evmos.org/modules/erc20/",target:"_blank",rel:"noopener noreferrer"}},[c._v("erc20 module"),l("OutboundLink")],1),c._v(" that shows how the "),l("code",[c._v("EVMHooks")]),c._v(" supports a contract calling a native module to convert ERC-20 Tokens into Cosmos native Coins. Following the steps from above.")]),c._v(" "),l("p",[c._v("You can define and emit a "),l("code",[c._v("Transfer")]),c._v(" log signature in the smart contract like this:")]),c._v(" "),l("tm-code-block",{staticClass:"codeblock",attrs:{language:"solidity",base64:"ZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CgpmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBzZW5kZXIsIGFkZHJlc3MgcmVjaXBpZW50LCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgdmlydHVhbCB7CiAgcmVxdWlyZShzZW5kZXIgIT0gYWRkcmVzcygwKSwgJnF1b3Q7RVJDMjA6IHRyYW5zZmVyIGZyb20gdGhlIHplcm8gYWRkcmVzcyZxdW90Oyk7CiAgcmVxdWlyZShyZWNpcGllbnQgIT0gYWRkcmVzcygwKSwgJnF1b3Q7RVJDMjA6IHRyYW5zZmVyIHRvIHRoZSB6ZXJvIGFkZHJlc3MmcXVvdDspOwoKICBfYmVmb3JlVG9rZW5UcmFuc2ZlcihzZW5kZXIsIHJlY2lwaWVudCwgYW1vdW50KTsKCiAgX2JhbGFuY2VzW3NlbmRlcl0gPSBfYmFsYW5jZXNbc2VuZGVyXS5zdWIoYW1vdW50LCAmcXVvdDtFUkMyMDogdHJhbnNmZXIgYW1vdW50IGV4Y2VlZHMgYmFsYW5jZSZxdW90Oyk7CiAgX2JhbGFuY2VzW3JlY2lwaWVudF0gPSBfYmFsYW5jZXNbcmVjaXBpZW50XS5hZGQoYW1vdW50KTsKICBlbWl0IFRyYW5zZmVyKHNlbmRlciwgcmVjaXBpZW50LCBhbW91bnQpOwp9Cg=="}}),c._v(" "),l("p",[c._v("The application will register a "),l("code",[c._v("BankSendHook")]),c._v(" to the "),l("code",[c._v("EvmKeeper")]),c._v(". It recognizes the ethereum tx "),l("code",[c._v("Log")]),c._v(" and converts it to a call to the bank module's "),l("code",[c._v("SendCoinsFromAccountToAccount")]),c._v(" method:")]),c._v(" "),l("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"CmNvbnN0IEVSQzIwRXZlbnRUcmFuc2ZlciA9ICZxdW90O1RyYW5zZmVyJnF1b3Q7CgovLyBQb3N0VHhQcm9jZXNzaW5nIGltcGxlbWVudHMgRXZtSG9va3MuUG9zdFR4UHJvY2Vzc2luZwpmdW5jIChrIEtlZXBlcikgUG9zdFR4UHJvY2Vzc2luZygKIGN0eCBzZGsuQ29udGV4dCwKIG1zZyBjb3JlLk1lc3NhZ2UsCiByZWNlaXB0ICpldGh0eXBlcy5SZWNlaXB0LAopIGVycm9yIHsKIHBhcmFtcyA6PSBoLmsuR2V0UGFyYW1zKGN0eCkKIGlmICFwYXJhbXMuRW5hYmxlRXJjMjAgfHwgIXBhcmFtcy5FbmFibGVFVk1Ib29rIHsKICAvLyBubyBlcnJvciBpcyByZXR1cm5lZCB0byBhbGxvdyBmb3Igb3RoZXIgcG9zdCBwcm9jZXNzaW5nIHR4cwogIC8vIHRvIHBhc3MKICByZXR1cm4gbmlsCiB9CgogZXJjMjAgOj0gY29udHJhY3RzLkVSQzIwQnVybmFibGVDb250cmFjdC5BQkkKCiBmb3IgaSwgbG9nIDo9IHJhbmdlIHJlY2VpcHQuTG9ncyB7CiAgaWYgbGVuKGxvZy5Ub3BpY3MpICZsdDsgMyB7CiAgIGNvbnRpbnVlCiAgfQoKICBldmVudElEIDo9IGxvZy5Ub3BpY3NbMF0gLy8gZXZlbnQgSUQKCiAgZXZlbnQsIGVyciA6PSBlcmMyMC5FdmVudEJ5SUQoZXZlbnRJRCkKICBpZiBlcnIgIT0gbmlsIHsKICAgLy8gaW52YWxpZCBldmVudCBmb3IgRVJDMjAKICAgY29udGludWUKICB9CgogIGlmIGV2ZW50Lk5hbWUgIT0gdHlwZXMuRVJDMjBFdmVudFRyYW5zZmVyIHsKICAgaC5rLkxvZ2dlcihjdHgpLkluZm8oJnF1b3Q7ZW1pdHRlZCBldmVudCZxdW90OywgJnF1b3Q7bmFtZSZxdW90OywgZXZlbnQuTmFtZSwgJnF1b3Q7c2lnbmF0dXJlJnF1b3Q7LCBldmVudC5TaWcpCiAgIGNvbnRpbnVlCiAgfQoKICB0cmFuc2ZlckV2ZW50LCBlcnIgOj0gZXJjMjAuVW5wYWNrKGV2ZW50Lk5hbWUsIGxvZy5EYXRhKQogIGlmIGVyciAhPSBuaWwgewogICBoLmsuTG9nZ2VyKGN0eCkuRXJyb3IoJnF1b3Q7ZmFpbGVkIHRvIHVucGFjayB0cmFuc2ZlciBldmVudCZxdW90OywgJnF1b3Q7ZXJyb3ImcXVvdDssIGVyci5FcnJvcigpKQogICBjb250aW51ZQogIH0KCiAgaWYgbGVuKHRyYW5zZmVyRXZlbnQpID09IDAgewogICBjb250aW51ZQogIH0KCiAgdG9rZW5zLCBvayA6PSB0cmFuc2ZlckV2ZW50WzBdLigqYmlnLkludCkKICAvLyBzYWZldHkgY2hlY2sgYW5kIGlnbm9yZSBpZiBhbW91bnQgbm90IHBvc2l0aXZlCiAgaWYgIW9rIHx8IHRva2VucyA9PSBuaWwgfHwgdG9rZW5zLlNpZ24oKSAhPSAxIHsKICAgY29udGludWUKICB9CgogIC8vIGNoZWNrIHRoYXQgdGhlIGNvbnRyYWN0IGlzIGEgcmVnaXN0ZXJlZCB0b2tlbiBwYWlyCiAgY29udHJhY3RBZGRyIDo9IGxvZy5BZGRyZXNzCgogIGlkIDo9IGguay5HZXRFUkMyME1hcChjdHgsIGNvbnRyYWN0QWRkcikKCiAgaWYgbGVuKGlkKSA9PSAwIHsKICAgLy8gbm8gdG9rZW4gaXMgcmVnaXN0ZXJlZCBmb3IgdGhlIGNhbGxlciBjb250cmFjdAogICBjb250aW51ZQogIH0KCiAgcGFpciwgZm91bmQgOj0gaC5rLkdldFRva2VuUGFpcihjdHgsIGlkKQogIGlmICFmb3VuZCB7CiAgIGNvbnRpbnVlCiAgfQoKICAvLyBjaGVjayB0aGF0IGNvbnZlcnNpb24gZm9yIHRoZSBwYWlyIGlzIGVuYWJsZWQKICBpZiAhcGFpci5FbmFibGVkIHsKICAgLy8gY29udGludWUgdG8gYWxsb3cgdHJhbnNmZXJzIGZvciB0aGUgRVJDMjAgaW4gY2FzZSB0aGUgdG9rZW4gcGFpciBpcyBkaXNhYmxlZAogICBoLmsuTG9nZ2VyKGN0eCkuRGVidWcoCiAgICAmcXVvdDtFUkMyMCB0b2tlbiAtJmd0OyBDb3Ntb3MgY29pbiBjb252ZXJzaW9uIGlzIGRpc2FibGVkIGZvciBwYWlyJnF1b3Q7LAogICAgJnF1b3Q7Y29pbiZxdW90OywgcGFpci5EZW5vbSwgJnF1b3Q7Y29udHJhY3QmcXVvdDssIHBhaXIuRXJjMjBBZGRyZXNzLAogICApCiAgIGNvbnRpbnVlCiAgfQoKICAvLyBpZ25vcmUgYXMgdGhlIGJ1cm5pbmcgYWx3YXlzIHRyYW5zZmVycyB0byB0aGUgemVybyBhZGRyZXNzCiAgdG8gOj0gY29tbW9uLkJ5dGVzVG9BZGRyZXNzKGxvZy5Ub3BpY3NbMl0uQnl0ZXMoKSkKICBpZiAhYnl0ZXMuRXF1YWwodG8uQnl0ZXMoKSwgdHlwZXMuTW9kdWxlQWRkcmVzcy5CeXRlcygpKSB7CiAgIGNvbnRpbnVlCiAgfQoKICAvLyBjaGVjayB0aGF0IHRoZSBldmVudCBpcyBCdXJuIGZyb20gdGhlIEVSQzIwQnVybmFibGUgaW50ZXJmYWNlCiAgLy8gTk9URTogYXNzdW1lIHRoYXQgaWYgdGhleSBhcmUgYnVybmluZyB0aGUgdG9rZW4gdGhhdCBoYXMgYmVlbiByZWdpc3RlcmVkIGFzIGEgcGFpciwgdGhleSB3YW50IHRvIG1pbnQgYSBDb3Ntb3MgY29pbgoKICAvLyBjcmVhdGUgdGhlIGNvcnJlc3BvbmRpbmcgc2RrLkNvaW4gdGhhdCBpcyBwYWlyZWQgd2l0aCBFUkMyMAogIGNvaW5zIDo9IHNkay5Db2luc3t7RGVub206IHBhaXIuRGVub20sIEFtb3VudDogc2RrLk5ld0ludEZyb21CaWdJbnQodG9rZW5zKX19CgogIC8vIE1pbnQgdGhlIGNvaW4gb25seSBpZiBFUkMyMCBpcyBleHRlcm5hbAogIHN3aXRjaCBwYWlyLkNvbnRyYWN0T3duZXIgewogIGNhc2UgdHlwZXMuT1dORVJfTU9EVUxFOgogICBfLCBlcnIgPSBoLmsuQ2FsbEVWTShjdHgsIGVyYzIwLCB0eXBlcy5Nb2R1bGVBZGRyZXNzLCBjb250cmFjdEFkZHIsIHRydWUsICZxdW90O2J1cm4mcXVvdDssIHRva2VucykKICBjYXNlIHR5cGVzLk9XTkVSX0VYVEVSTkFMOgogICBlcnIgPSBoLmsuYmFua0tlZXBlci5NaW50Q29pbnMoY3R4LCB0eXBlcy5Nb2R1bGVOYW1lLCBjb2lucykKICBkZWZhdWx0OgogICBlcnIgPSB0eXBlcy5FcnJVbmRlZmluZWRPd25lcgogIH0KCiAgaWYgZXJyICE9IG5pbCB7CiAgIGguay5Mb2dnZXIoY3R4KS5EZWJ1ZygKICAgICZxdW90O2ZhaWxlZCB0byBwcm9jZXNzIEVWTSBob29rIGZvciBFUjIwIC0mZ3Q7IGNvaW4gY29udmVyc2lvbiZxdW90OywKICAgICZxdW90O2NvaW4mcXVvdDssIHBhaXIuRGVub20sICZxdW90O2NvbnRyYWN0JnF1b3Q7LCBwYWlyLkVyYzIwQWRkcmVzcywgJnF1b3Q7ZXJyb3ImcXVvdDssIGVyci5FcnJvcigpLAogICApCiAgIGNvbnRpbnVlCiAgfQoKICAvLyBPbmx5IG5lZWQgbGFzdCAyMCBieXRlcyBmcm9tIGxvZy50b3BpY3MKICBmcm9tIDo9IGNvbW1vbi5CeXRlc1RvQWRkcmVzcyhsb2cuVG9waWNzWzFdLkJ5dGVzKCkpCiAgcmVjaXBpZW50IDo9IHNkay5BY2NBZGRyZXNzKGZyb20uQnl0ZXMoKSkKCiAgLy8gdHJhbnNmZXIgdGhlIHRva2VucyBmcm9tIE1vZHVsZUFjY291bnQgdG8gc2VuZGVyIGFkZHJlc3MKICBpZiBlcnIgOj0gaC5rLmJhbmtLZWVwZXIuU2VuZENvaW5zRnJvbU1vZHVsZVRvQWNjb3VudChjdHgsIHR5cGVzLk1vZHVsZU5hbWUsIHJlY2lwaWVudCwgY29pbnMpOyBlcnIgIT0gbmlsIHsKICAgaC5rLkxvZ2dlcihjdHgpLkRlYnVnKAogICAgJnF1b3Q7ZmFpbGVkIHRvIHByb2Nlc3MgRVZNIGhvb2sgZm9yIEVSMjAgLSZndDsgY29pbiBjb252ZXJzaW9uJnF1b3Q7LAogICAgJnF1b3Q7dHgtaGFzaCZxdW90OywgcmVjZWlwdC5UeEhhc2guSGV4KCksICZxdW90O2xvZy1pZHgmcXVvdDssIGksCiAgICAmcXVvdDtjb2luJnF1b3Q7LCBwYWlyLkRlbm9tLCAmcXVvdDtjb250cmFjdCZxdW90OywgcGFpci5FcmMyMEFkZHJlc3MsICZxdW90O2Vycm9yJnF1b3Q7LCBlcnIuRXJyb3IoKSwKICAgKQogICBjb250aW51ZQogIH0KIH0KCiByZXR1cm4gbmlsCg=="}}),c._v(" "),l("p",[c._v("Lastly, register the hook in "),l("code",[c._v("app.go")]),c._v(":")]),c._v(" "),l("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YXBwLkV2bUtlZXBlciA9IGFwcC5Fdm1LZWVwZXIuU2V0SG9va3MoYXBwLkVyYzIwS2VlcGVyKQo="}})],1)}),[],!1,null,null,null);g.default=e.exports}}]);